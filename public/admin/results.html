<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publication des Résultats - Admin UCAO</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bordeaux: #7B2D3A;
            --bleu-nuit: #020b66;
            --or: #D4AF37;
            --blanc: #FFFFFF;
            --gris-clair: #F5F5F5;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--gris-clair);
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--blanc);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 25px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--or);
        }

        .header h1 {
            color: var(--bleu-nuit);
            font-size: 2rem;
            display: flex;
            align-items: center;
        }

        .header h1 i {
            color: var(--bordeaux);
            margin-right: 15px;
        }

        .btn {
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--bleu-nuit);
            color: var(--blanc);
        }

        .btn-success {
            background: var(--success);
            color: var(--blanc);
        }

        .btn-warning {
            background: var(--warning);
            color: var(--bleu-nuit);
        }

        .btn-danger {
            background: var(--danger);
            color: var(--blanc);
        }

        .results-container {
            margin-top: 30px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-top: 4px solid var(--or);
        }

        .result-card.winner {
            border-top: 4px solid var(--success);
            background: rgba(40, 167, 69, 0.05);
        }

        .candidate-name {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--bleu-nuit);
        }

        .vote-count {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--bordeaux);
            margin-bottom: 5px;
        }

        .vote-percentage {
            color: #666;
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: var(--or);
            border-radius: 5px;
        }

        .publication-controls {
            background: rgba(26, 43, 60, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid var(--bordeaux);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--bleu-nuit);
        }

        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        .audit-log {
            margin-top: 30px;
        }

        .audit-item {
            padding: 15px;
            border-left: 4px solid var(--bleu-nuit);
            background: rgba(26, 43, 60, 0.05);
            margin-bottom: 15px;
            border-radius: 0 8px 8px 0;
        }

        .audit-item.published {
            border-left-color: var(--success);
        }

        .audit-item.unpublished {
            border-left-color: var(--warning);
        }

        .audit-action {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .audit-details {
            color: #666;
            font-size: 0.9rem;
        }

        .audit-time {
            color: #999;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-chart-bar"></i> Publication des Résultats</h1>
            <div>
                <button class="btn btn-primary" onclick="window.history.back()">
                    <i class="fas fa-arrow-left"></i> Retour
                </button>
            </div>
        </div>

        <div class="publication-controls">
            <h2>Contrôles de Publication</h2>
            <div class="form-group">
                <label for="electionSelect">Sélectionner une élection:</label>
                <select id="electionSelect">
                    <option value="">-- Choisir une élection --</option>
                    <option value="1">Élection des Responsables de Salle</option>
                    <option value="2">Élection des Délégués d'École</option>
                    <option value="3">Élection des Délégués Universitaires</option>
                </select>
            </div>

            <div id="electionInfo" style="display: none;">
                <h3>Informations sur l'élection</h3>
                <p><strong>Phase:</strong> <span id="electionPhase"></span></p>
                <p><strong>Période de vote:</strong> <span id="electionPeriod"></span></p>
                <p><strong>Statut:</strong> <span id="electionStatus"></span></p>

                <div id="publicationStatus" style="margin: 20px 0; padding: 15px; border-radius: 8px;">
                    <h3>Statut de publication</h3>
                    <p id="statusText">Les résultats n'ont pas encore été publiés.</p>
                </div>

                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-success" id="publishBtn">
                        <i class="fas fa-check-circle"></i> Publier les résultats
                    </button>
                    <button class="btn btn-warning" id="unpublishBtn" style="display: none;">
                        <i class="fas fa-eye-slash"></i> Masquer les résultats
                    </button>
                    <button class="btn btn-primary" id="calculateBtn">
                        <i class="fas fa-calculator"></i> Calculer les résultats
                    </button>
                    <button class="btn btn-danger" id="auditBtn">
                        <i class="fas fa-history"></i> Voir l'historique
                    </button>
                </div>
            </div>
        </div>

        <div class="results-container" id="resultsContainer" style="display: none;">
            <h2>Résultats de l'élection</h2>
            <div class="results-grid" id="resultsGrid">
                <!-- Les résultats seront affichés ici -->
            </div>

            <div class="audit-log" id="auditLog" style="display: none;">
                <h2>Historique de publication</h2>
                <div id="auditItems">
                    <!-- Les éléments d'audit seront affichés ici -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Données simulées pour la démonstration
        const electionData = {
            1: {
                title: "Élection des Responsables de Salle - EGEI L1 Info",
                phase: "PHASE1",
                startDate: "2023-10-15",
                endDate: "2023-10-20",
                status: "Terminée",
                resultsPublished: false,
                candidates: [
                    { id: 1, name: "Jean Dupont", votes: 150, percentage: 45.5 },
                    { id: 2, name: "Marie Martin", votes: 120, percentage: 36.4 },
                    { id: 3, name: "Pierre Leroy", votes: 60, percentage: 18.2 }
                ],
                auditLog: [
                    { action: "CALCULATED", performedBy: "Admin 1", performedAt: "2023-10-20 18:30:00", details: "Calcul initial des résultats" }
                ]
            },
            2: {
                title: "Élection des Délégués d'École - EGEI",
                phase: "PHASE2",
                startDate: "2023-10-25",
                endDate: "2023-10-30",
                status: "Terminée",
                resultsPublished: true,
                candidates: [
                    { id: 4, name: "Sophie Lambert", votes: 320, percentage: 52.5, winner: true },
                    { id: 5, name: "Thomas Moreau", votes: 290, percentage: 47.5 }
                ],
                auditLog: [
                    { action: "CALCULATED", performedBy: "Admin 2", performedAt: "2023-10-30 19:15:00", details: "Calcul initial des résultats" },
                    { action: "PUBLISHED", performedBy: "Admin 2", performedAt: "2023-10-30 20:45:00", details: "Publication des résultats" }
                ]
            },
            3: {
                title: "Élection des Délégués Universitaires",
                phase: "PHASE3",
                startDate: "2023-11-05",
                endDate: "2023-11-10",
                status: "En cours",
                resultsPublished: false,
                candidates: [],
                auditLog: []
            }
        };

        document.getElementById('electionSelect').addEventListener('change', function () {
            const electionId = this.value;
            const electionInfo = document.getElementById('electionInfo');
            const resultsContainer = document.getElementById('resultsContainer');

            if (electionId && electionData[electionId]) {
                const election = electionData[electionId];
                electionInfo.style.display = 'block';

                document.getElementById('electionPhase').textContent = getPhaseLabel(election.phase);
                document.getElementById('electionPeriod').textContent = `${election.startDate} au ${election.endDate}`;
                document.getElementById('electionStatus').textContent = election.status;

                const statusDiv = document.getElementById('publicationStatus');
                const statusText = document.getElementById('statusText');

                if (election.resultsPublished) {
                    statusDiv.style.backgroundColor = 'rgba(40, 167, 69, 0.1)';
                    statusDiv.style.border = '1px solid rgba(40, 167, 69, 0.2)';
                    statusText.innerHTML = '<i class="fas fa-check-circle" style="color: #28a745;"></i> Résultats publiés';
                    document.getElementById('publishBtn').style.display = 'none';
                    document.getElementById('unpublishBtn').style.display = 'flex';
                } else {
                    statusDiv.style.backgroundColor = 'rgba(255, 193, 7, 0.1)';
                    statusDiv.style.border = '1px solid rgba(255, 193, 7, 0.2)';
                    statusText.innerHTML = '<i class="fas fa-eye-slash" style="color: #ffc107;"></i> Résultats non publiés';
                    document.getElementById('publishBtn').style.display = 'flex';
                    document.getElementById('unpublishBtn').style.display = 'none';
                }

                if (election.candidates.length > 0) {
                    resultsContainer.style.display = 'block';
                    renderResults(election.candidates);
                } else {
                    resultsContainer.style.display = 'none';
                }

                document.getElementById('auditLog').style.display = 'none';
            } else {
                electionInfo.style.display = 'none';
                resultsContainer.style.display = 'none';
            }
        });

        document.getElementById('publishBtn').addEventListener('click', function () {
            const electionId = document.getElementById('electionSelect').value;
            if (confirm('Êtes-vous sûr de vouloir publier ces résultats ? Cette action sera enregistrée dans l\'historique.')) {
                // Simulation de publication
                electionData[electionId].resultsPublished = true;
                electionData[electionId].auditLog.push({
                    action: 'PUBLISHED',
                    performedBy: 'Administrateur actuel',
                    performedAt: new Date().toLocaleString(),
                    details: 'Publication des résultats'
                });

                // Rafraîchir l'affichage
                document.getElementById('electionSelect').dispatchEvent(new Event('change'));
                alert('Résultats publiés avec succès !');
            }
        });

        document.getElementById('unpublishBtn').addEventListener('click', function () {
            const electionId = document.getElementById('electionSelect').value;
            if (confirm('Êtes-vous sûr de vouloir masquer ces résultats ?')) {
                // Simulation de masquage
                electionData[electionId].resultsPublished = false;
                electionData[electionId].auditLog.push({
                    action: 'UNPUBLISHED',
                    performedBy: 'Administrateur actuel',
                    performedAt: new Date().toLocaleString(),
                    details: 'Masquage des résultats'
                });

                // Rafraîchir l'affichage
                document.getElementById('electionSelect').dispatchEvent(new Event('change'));
                alert('Résultats masqués avec succès !');
            }
        });

        document.getElementById('calculateBtn').addEventListener('click', function () {
            alert('Fonctionnalité de calcul des résultats à implémenter');
        });

        document.getElementById('auditBtn').addEventListener('click', function () {
            const electionId = document.getElementById('electionSelect').value;
            const auditLog = document.getElementById('auditLog');
            const auditItems = document.getElementById('auditItems');

            if (auditLog.style.display === 'none') {
                auditItems.innerHTML = '';

                electionData[electionId].auditLog.forEach(log => {
                    const item = document.createElement('div');
                    item.className = `audit-item ${log.action.toLowerCase()}`;

                    let actionText = '';
                    let icon = '';

                    switch (log.action) {
                        case 'PUBLISHED':
                            actionText = 'Résultats publiés';
                            icon = 'fa-check-circle';
                            break;
                        case 'UNPUBLISHED':
                            actionText = 'Résultats masqués';
                            icon = 'fa-eye-slash';
                            break;
                        case 'CALCULATED':
                            actionText = 'Résultats calculés';
                            icon = 'fa-calculator';
                            break;
                    }

                    item.innerHTML = `
                        <div class="audit-action"><i class="fas ${icon}"></i> ${actionText}</div>
                        <div class="audit-details">${log.details}</div>
                        <div class="audit-time">Par ${log.performedBy} le ${log.performedAt}</div>
                    `;

                    auditItems.appendChild(item);
                });

                auditLog.style.display = 'block';
            } else {
                auditLog.style.display = 'none';
            }
        });

        function renderResults(candidates) {
            const resultsGrid = document.getElementById('resultsGrid');
            resultsGrid.innerHTML = '';

            // Trouver le nombre maximum de votes pour l'échelle du graphique
            const maxVotes = Math.max(...candidates.map(c => c.votes));

            candidates.forEach(candidate => {
                const card = document.createElement('div');
                card.className = `result-card ${candidate.winner ? 'winner' : ''}`;

                card.innerHTML = `
                    <div class="candidate-name">${candidate.name}</div>
                    <div class="vote-count">${candidate.votes} votes</div>
                    <div class="vote-percentage">${candidate.percentage}%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${candidate.percentage}%"></div>
                    </div>
                    ${candidate.winner ? '<div style="color: #28a745; font-weight: bold;"><i class="fas fa-trophy"></i> Élu(e)</div>' : ''}
                `;

                resultsGrid.appendChild(card);
            });
        }

        function getPhaseLabel(phase) {
            const phases = {
                'PHASE1': 'Phase 1 - Responsables de Salle',
                'PHASE2': 'Phase 2 - Délégués d\'École',
                'PHASE3': 'Phase 3 - Délégués Universitaires'
            };
            return phases[phase] || phase;
        }
    </script>
</body>

</html>