<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Dashboard Admin UCAO</title>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* Couleurs */
            --rouge-bordeaux: #7a0026;
            --rouge-bordeaux-light: #a73354;
            --bleu-nuit: #0f1a31;
            --bleu-nuit-light: #1e2b4d;
            --or: #c9a227;
            --blanc-casse: #f8f4e9;
            --gris-clair: #e5e5e5;
            --gris-moyen: #999999;

            /* Effets */
            --shadow-sm: 0 2px 8px rgba(15, 26, 49, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Reset et base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--blanc-casse);
            color: var(--bleu-nuit);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Header amélioré */
        .main-header {
            background: linear-gradient(90deg, var(--bleu-nuit), var(--bleu-nuit-light));
            color: white;
            padding: 0.8rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-container img {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid var(--or);
            object-fit: cover;
        }

        .logo-text h1 {
            font-size: 1.4rem;
            font-weight: 600;
            margin: 0;
        }

        .logo-text p {
            font-size: 0.8rem;
            opacity: 0.8;
            margin: 0;
        }

        /* Navigation supérieure */
        .top-nav {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-icon {
            position: relative;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .nav-icon:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--rouge-bordeaux);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Menu utilisateur */
        .user-menu {
            position: relative;
        }

        .user-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 20px;
            transition: var(--transition);
        }

        .user-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--or);
            object-fit: cover;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-size: 0.9rem;
            font-weight: 500;
        }

        .user-role {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            width: 250px;
            border-radius: 8px;
            box-shadow: var(--shadow-md);
            margin-top: 10px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 1000;
        }

        .dropdown-menu.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: var(--bleu-nuit);
            text-decoration: none;
            transition: var(--transition);
            border-bottom: 1px solid var(--gris-clair);
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background-color: #f5f5f5;
            color: var(--rouge-bordeaux);
        }

        .dropdown-item i {
            color: var(--rouge-bordeaux);
            width: 20px;
        }

        /* Sidebar amélioré */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--bleu-nuit), #1a2748);
            color: white;
            padding: 25px 0;
            box-shadow: var(--shadow-md);
            transition: transform 0.3s ease;
            z-index: 900;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            top: 73px;
        }

        .sidebar-header {
            text-align: center;
            padding: 0 25px 25px;
            border-bottom: 1px solid var(--bleu-nuit-light);
        }

        .sidebar-menu {
            padding: 20px 15px 0;
        }

        .sidebar-menu h3 {
            color: var(--gris-clair);
            font-size: 0.75rem;
            text-transform: uppercase;
            margin: 25px 0 15px 10px;
        }

        .sidebar-menu li {
            list-style: none;
            margin-bottom: 5px;
            position: relative;
        }

        .sidebar-menu li a {
            display: flex;
            align-items: center;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            padding: 12px 15px;
            border-radius: 6px;
            transition: var(--transition);
        }

        .sidebar-menu li a i {
            margin-right: 12px;
            color: var(--or);
            font-size: 1rem;
            width: 20px;
            text-align: center;
        }

        .sidebar-menu li a:hover {
            background: linear-gradient(90deg, rgba(122, 0, 38, 0.2), rgba(0, 0, 0, 0.1));
            transform: translateX(5px);
        }

        .sidebar-menu li.active a {
            background: linear-gradient(to right, rgba(122, 0, 38, 0.3), transparent);
            color: white;
            border-left: 3px solid var(--or);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            margin-left: 280px;
            margin-top: 73px;
            background-color: #f9f9f9;
            min-height: calc(100vh - 73px);
            transition: margin 0.3s ease;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gris-clair);
        }

        .page-header h1 {
            color: var(--bleu-nuit);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
        }

        .page-header h1 i {
            color: var(--rouge-bordeaux);
            margin-right: 15px;
        }

        /* Cartes statistiques */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .admin-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: var(--shadow-sm);
            transition: transform 0.25s ease, box-shadow 0.25s ease;
            border-left: 4px solid var(--rouge-bordeaux);
        }

        .admin-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--or);
        }

        .admin-card h3 {
            color: var(--bleu-nuit);
            font-size: 1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .admin-card h3 i {
            margin-right: 10px;
            color: var(--rouge-bordeaux);
        }

        .admin-card p {
            font-size: 2rem;
            font-weight: 700;
            color: var(--bleu-nuit);
            margin-bottom: 5px;
        }

        .admin-card small {
            color: var(--gris-moyen);
            font-size: 0.85rem;
        }

        .progress-bar {
            height: 6px;
            background-color: var(--gris-clair);
            border-radius: 3px;
            margin-top: 10px;
        }

        .progress {
            height: 100%;
            background: linear-gradient(to right, var(--rouge-bordeaux), var(--or));
            border-radius: 3px;
            transition: width 1s ease;
        }

        /* Section activités */
        .activity-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 30px;
        }

        .section-title {
            color: var(--bleu-nuit);
            font-size: 1.4rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .section-title i {
            color: var(--rouge-bordeaux);
            margin-right: 10px;
        }

        .activity-item {
            display: flex;
            padding: 15px 0;
            border-bottom: 1px solid var(--gris-clair);
            align-items: center;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(122, 0, 38, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: var(--rouge-bordeaux);
        }

        .activity-content h4 {
            color: var(--bleu-nuit);
            margin-bottom: 5px;
        }

        .activity-content p {
            color: var(--gris-moyen);
            font-size: 0.9rem;
        }

        .activity-time {
            color: var(--gris-moyen);
            font-size: 0.8rem;
            margin-left: auto;
            min-width: 80px;
            text-align: right;
        }

        /* Actions rapides */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border-top: 3px solid var(--rouge-bordeaux);
            cursor: pointer;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .action-card i {
            font-size: 2rem;
            color: var(--rouge-bordeaux);
            margin-bottom: 10px;
        }

        .action-card h3 {
            color: var(--bleu-nuit);
            margin-bottom: 8px;
        }

        .action-card p {
            color: var(--gris-moyen);
            font-size: 0.9rem;
        }

        /* Génération de codes */
        .generation-section {
            margin-bottom: 2rem;
        }

        .input-group {
            display: flex;
            gap: 10px;
            max-width: 500px;
        }

        #codeCountInput {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--rouge-bordeaux), var(--rouge-bordeaux-light));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            background: linear-gradient(90deg, var(--rouge-bordeaux-light), var(--rouge-bordeaux));
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .generated-codes-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            box-shadow: var(--shadow-sm);
            border-top: 3px solid var(--rouge-bordeaux);
        }

        /* Styles pour les notifications */
        .notification-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 350px;
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow-md);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-panel.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .notification-header {
            padding: 15px;
            border-bottom: 1px solid var(--gris-clair);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-item {
            padding: 15px;
            border-bottom: 1px solid var(--gris-clair);
            cursor: pointer;
            transition: var(--transition);
        }

        .notification-item:hover {
            background-color: #f9f9f9;
        }

        .notification-item.unread {
            background-color: rgba(122, 0, 38, 0.05);
        }

        .notification-content {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .notification-time {
            font-size: 0.75rem;
            color: var(--gris-moyen);
        }

        /* Styles pour les modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1100;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-md);
            transform: scale(0.9);
            transition: var(--transition);
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gris-clair);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--gris-clair);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Styles pour l'import de fichiers */
        .file-drop-area {
            border: 2px dashed var(--gris-clair);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }

        .file-drop-area:hover {
            border-color: var(--rouge-bordeaux);
        }

        .file-drop-area.active {
            border-color: var(--rouge-bordeaux);
            background-color: rgba(122, 0, 38, 0.05);
        }

        .file-input {
            display: none;
        }

        /* Styles pour les graphiques */
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-sm);
        }

        /* Styles pour les codes générés */
        .codes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .code-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 6px;
            border: 1px solid #eee;
        }

        .code-item span {
            font-family: monospace;
            font-size: 0.9rem;
        }

        .copy-single-btn {
            background: none;
            border: none;
            color: var(--rouge-bordeaux);
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .copy-single-btn:hover {
            background-color: rgba(122, 0, 38, 0.1);
        }

        .codes-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .codes-count {
            margin-left: 10px;
            background-color: var(--rouge-bordeaux);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .codes-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .action-btn {
            padding: 8px 15px;
            background-color: var(--bleu-nuit);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
        }

        .action-btn:hover {
            background-color: var(--bleu-nuit-light);
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
        }

        .toast {
            padding: 12px 20px;
            margin-bottom: 10px;
            border-radius: 6px;
            color: white;
            display: flex;
            align-items: center;
            box-shadow: var(--shadow-md);
            animation: slideIn 0.3s ease;
            max-width: 350px;
        }

        .toast i {
            margin-right: 10px;
        }

        .toast.success {
            background-color: #28a745;
        }

        .toast.error {
            background-color: var(--rouge-bordeaux);
        }

        .toast.info {
            background-color: var(--bleu-nuit);
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--or);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Menu toggle pour mobile */
        .menu-toggle {
            display: none;
            background: var(--rouge-bordeaux);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-md);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .sidebar {
                width: 250px;
            }

            .main-content {
                margin-left: 250px;
            }
        }

        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
                top: 73px;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .menu-toggle {
                display: flex;
            }

            .user-info {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .main-header {
                padding: 0.8rem 1rem;
            }

            .admin-stats,
            .quick-actions {
                grid-template-columns: 1fr;
            }

            .admin-card,
            .action-card {
                padding: 20px;
            }

            .input-group {
                flex-direction: column;
                max-width: 100%;
            }

            #codeCountInput {
                width: 100%;
            }

            .notification-panel {
                width: calc(100% - 40px);
                right: 20px;
            }

            .dropdown-menu {
                width: 200px;
            }
        }

        @media (max-width: 576px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .form-row {
                flex-direction: column;
            }

            .codes-grid {
                grid-template-columns: 1fr;
            }

            .notification-panel {
                width: calc(100% - 20px);
                right: 10px;
                left: 10px;
            }

            .logo-text h1 {
                font-size: 1.2rem;
            }

            .logo-text p {
                display: none;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-10px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Styles pour les pages dynamiques */
        .filters {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--bleu-nuit);
            margin-bottom: 5px;
        }

        .filter-group select,
        .filter-group input {
            padding: 10px 12px;
            border: 1px solid var(--gris-clair);
            border-radius: 6px;
            font-family: 'Poppins', sans-serif;
        }

        .search-box {
            display: flex;
            margin-left: auto;
        }

        .search-box input {
            padding: 10px 15px;
            border: 1px solid var(--gris-clair);
            border-radius: 6px 0 0 6px;
            width: 250px;
        }

        .search-box button {
            background: var(--rouge-bordeaux);
            color: white;
            border: none;
            border-radius: 0 6px 6px 0;
            padding: 0 15px;
            cursor: pointer;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            margin-bottom: 25px;
        }

        .table-header {
            display: grid;
            grid-template-columns: 1fr 120px 120px 120px 100px 100px;
            padding: 15px 20px;
            background: var(--bleu-nuit);
            color: white;
            font-weight: 600;
        }

        .table-row {
            display: grid;
            grid-template-columns: 1fr 120px 120px 120px 100px 100px;
            padding: 15px 20px;
            border-bottom: 1px solid var(--gris-clair);
            align-items: center;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-active {
            background: rgba(40, 167, 69, 0.15);
            color: #28a745;
        }

        .status-upcoming {
            background: rgba(23, 162, 184, 0.15);
            color: #17a2b8;
        }

        .status-completed {
            background: rgba(108, 117, 125, 0.15);
            color: #6c757d;
        }

        .status-inactive {
            background: rgba(108, 117, 125, 0.15);
            color: #6c757d;
        }

        .election-type {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            background: rgba(122, 0, 38, 0.1);
            color: var(--rouge-bordeaux);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-edit {
            background: rgba(58, 160, 255, 0.15);
            color: #3aa0ff;
        }

        .btn-delete {
            background: rgba(220, 53, 69, 0.15);
            color: #dc3545;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: var(--shadow-sm);
            text-align: center;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(122, 0, 38, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: var(--rouge-bordeaux);
            font-size: 1.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--bleu-nuit);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--gris-moyen);
            font-size: 0.9rem;
        }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: var(--shadow-sm);
        }

        .chart-title {
            font-size: 1.2rem;
            color: var(--bleu-nuit);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .chart-title i {
            color: var(--rouge-bordeaux);
            margin-right: 10px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .export-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }

        .pagination-btn {
            width: 36px;
            height: 36px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 1px solid var(--gris-clair);
            cursor: pointer;
            transition: var(--transition);
        }

        .pagination-btn.active {
            background: var(--rouge-bordeaux);
            color: white;
            border-color: var(--rouge-bordeaux);
        }

        .pagination-btn:hover:not(.active) {
            background: var(--gris-clair);
        }

        .student-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--or);
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header amélioré -->
        <header class="main-header">
            <div class="logo-container">
                <div class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </div>
                <img src="https://img.freepik.com/photos-premium/photo-etudiant-i-image-etudiant-i-etudiants-souriants-i-etudiant-universitaire-i-etudiants-collage_403587-2980.jpg"
                    alt="Logo UCAO">
                <div class="logo-text">
                    <h1>Admin UCAO</h1>
                    <p>Portail d'administration</p>
                </div>
            </div>

            <div class="top-nav">
                <a href="#" class="nav-icon" id="notificationBtn">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationCount" style="display: none;">0</span>
                </a>

                <div class="user-menu">
                    <div class="user-toggle" id="userToggle">
                        <img src="https://img.freepik.com/photos-premium/photo-etudiant-i-image-etudiant-i-etudiants-souriants-i-etudiant-universitaire-i-etudiants-collage_403587-2980.jpg"
                            alt="Photo Admin" class="user-avatar">
                        <div class="user-info">
                            <span class="user-name" id="headerUserName">Admin UCAO</span>
                            <span class="user-role" id="headerUserRole">Administrateur</span>
                        </div>
                        <i class="fas fa-chevron-down"></i>
                    </div>

                    <div class="dropdown-menu" id="userDropdown">
                        <a href="profile.html" class="dropdown-item">
                            <i class="fas fa-user"></i>
                            <span>Mon Profil</span>
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-cog"></i>
                            <span>Paramètres</span>
                        </a>
                        <a href="#" class="dropdown-item">
                            <i class="fas fa-question-circle"></i>
                            <span>Aide</span>
                        </a>
                        <a href="#" class="dropdown-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Déconnexion</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <ul class="sidebar-menu">
                <h3>Général</h3>
                <li class="active"><a href="#" data-page="dashboard"><i class="fas fa-tachometer-alt"></i> Tableau de
                        Bord</a></li>
                <li><a href="#" data-page="users"><i class="fas fa-users"></i> Utilisateurs</a></li>
                <li><a href="#" data-page="elections"><i class="fas fa-vote-yea"></i> Élections</a></li>
                <li><a href="#" data-page="candidates"><i class="fas fa-user"></i> Candidats</a></li>
                <li><a href="#" data-page="statistics"><i class="fas fa-chart-pie"></i> Statistiques</a></li>
                <h3>Administration</h3>
                <li><a href="/"><i class="fas fa-home"></i> Accueil</a></li>
                <li><a href="profile.html"><i class="fas fa-user-cog"></i> Modifier Profil</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1><i class="fas fa-tachometer-alt"></i> Tableau de Bord</h1>
                <div class="breadcrumb">
                    <span>Admin</span> / <span>Tableau de Bord</span>
                </div>
            </div>

            <div id="dynamicContent">
                <!-- Le contenu sera chargé dynamiquement ici -->
            </div>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Notification Panel -->
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h3>Notifications</h3>
            <button id="markAllReadBtn">Tout marquer comme lu</button>
        </div>
        <div id="notificationList"></div>
    </div>

    <!-- Import Modal -->
    <div class="modal-overlay" id="importModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-file-import"></i> Importer des matricules</h3>
                <button class="close-btn" id="closeImportModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="file-drop-area" id="fileDropArea">
                    <i class="fas fa-cloud-upload-alt"
                        style="font-size: 2rem; margin-bottom: 15px; color: var(--gris-moyen);"></i>
                    <p>Glissez-déposez votre fichier ici ou</p>
                    <label class="btn btn-primary" for="fileInput" style="margin-top: 15px;">
                        <i class="fas fa-folder-open"></i> Parcourir
                    </label>
                    <input accept=".csv,.xlsx,.xls" class="file-input" id="fileInput" type="file" />
                </div>
                <div id="fileInfo" style="display: none; margin-top: 20px;">
                    <p><strong>Fichier sélectionné:</strong> <span id="fileName"></span></p>
                    <p><strong>Type:</strong> <span id="fileType"></span></p>
                    <p><strong>Taille:</strong> <span id="fileSize"></span></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelImport">Annuler</button>
                <button class="btn btn-primary" disabled id="confirmImport">Importer</button>
            </div>
        </div>
    </div>

    <script src="../config.js"></script>
    <script>
        // Fonction utilitaire pour gérer les event listeners
        function safeAddListener(id, event, handler) {
            const el = document.getElementById(id);
            if (el) {
                el.addEventListener(event, handler);
                return true;
            }
            console.error(`Element #${id} not found`);
            return false;
        }

        // Fonction pour créer des toasts
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            if (!toastContainer) return;

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                ${message}
            `;

            toastContainer.appendChild(toast);

            // Supprimer le toast après 5 secondes
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // ------------ CONFIG ------------
        const API_BASE = CONFIG.API.BASE_URL;
        const FRONTEND_BASE = window.location.origin;
        const ADMIN_ME_ENDPOINT = CONFIG.API.ENDPOINTS.ADMIN.ME;
        const ADMIN_UPDATE_ENDPOINT = CONFIG.API.ENDPOINTS.ADMIN.UPDATE;
        const UPLOAD_IMAGE_ENDPOINT = CONFIG.API.ENDPOINTS.UPLOAD.IMAGE;
        const STATS_ENDPOINT = CONFIG.API.ENDPOINTS.STATS.GENERAL;
        const ACTIVITY_ENDPOINT = CONFIG.API.ENDPOINTS.ACTIVITY.LIST;
        const CODES_GENERATE_ENDPOINT = CONFIG.API.ENDPOINTS.CODES.GENERATE;
        const CANDIDATES_ENDPOINT = CONFIG.API.ENDPOINTS.CANDIDATE.LIST;
        const ELECTIONS_ENDPOINT = CONFIG.API.ENDPOINTS.ELECTION.LIST;
        const VOTE_STATS_ENDPOINT = CONFIG.API.ENDPOINTS.STATS.DASHBOARD;
        const STUDENTS_ENDPOINT = CONFIG.API.ENDPOINTS.STUDENTS.LIST;
        const STUDENT_UPDATE_ENDPOINT = CONFIG.API.ENDPOINTS.STUDENTS.UPDATE_STATUS;
        const STUDENT_SEARCH_ENDPOINT = CONFIG.API.ENDPOINTS.STUDENTS.SEARCH;
        const STATS_VOTES_ENDPOINT = CONFIG.API.ENDPOINTS.STATS.VOTES;
        const STATS_DISTRIBUTION_ENDPOINT = CONFIG.API.ENDPOINTS.STATS.DISTRIBUTION;
        const STATS_HOURLY_ENDPOINT = CONFIG.API.ENDPOINTS.STATS.HOURLY;
        const STATS_COMPARISON_ENDPOINT = CONFIG.API.ENDPOINTS.STATS.COMPARISON;
        const STATS_EXPORT_ENDPOINT = CONFIG.API.ENDPOINTS.STATS.EXPORT;
        const NOTIFICATIONS_ENDPOINT = CONFIG.API.ENDPOINTS.NOTIFICATIONS.LIST;
        const NOTIFICATIONS_READ_ENDPOINT = CONFIG.API.ENDPOINTS.NOTIFICATIONS.READ;

        const token = localStorage.getItem('adminToken');

        if (!token) {
            showToast('Session expirée, redirection...', 'error');
            setTimeout(() => {
                window.location.href = `${FRONTEND_BASE}/index.html`;
            }, 2000);
        }

        // ------------ UTILS ------------
        function showLoading() {
            const loader = document.getElementById('loadingOverlay');
            if (loader) loader.classList.add('active');
        }

        function hideLoading() {
            const loader = document.getElementById('loadingOverlay');
            if (loader) loader.classList.remove('active');
        }

        // Formatage de la taille des fichiers
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Fonction debounce pour la recherche
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Formatage de date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('fr-FR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ------------ DYNAMIC CONTENT LOADING ------------
        const dynamicContent = document.getElementById('dynamicContent');
        const pageTitle = document.querySelector('.page-header h1');
        const breadcrumb = document.querySelector('.breadcrumb');

        // Templates pour chaque page
        const pageTemplates = {
            dashboard: `
                <!-- Stats Cards -->
                <div class="admin-stats">
                    <div class="admin-card">
                        <h3><i class="fas fa-user-check"></i> Utilisateurs Actifs</h3>
                        <p id="totalUsers">0</p>
                        <small>+0% ce mois</small>
                        <div class="progress-bar">
                            <div class="progress" id="usersProgress"></div>
                        </div>
                    </div>
                    <div class="admin-card">
                        <h3><i class="fas fa-vote-yea"></i> Votes Effectués</h3>
                        <p id="totalVotes">0</p>
                        <small>+0% aujourd'hui</small>
                        <div class="progress-bar">
                            <div class="progress" id="votesProgress"></div>
                        </div>
                    </div>
                    <div class="admin-card">
                        <h3><i class="fas fa-user-tie"></i> Candidats</h3>
                        <p id="totalCandidates">0</p>
                        <small>Total candidats</small>
                        <div class="progress-bar">
                            <div class="progress" id="candidatesProgress"></div>
                        </div>
                    </div>
                    <div class="admin-card">
                        <h3><i class="fas fa-vote-yea"></i> Élections Actives</h3>
                        <p id="activeElections">0</p>
                        <small>En cours</small>
                        <div class="progress-bar">
                            <div class="progress" id="electionsProgress"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Graphiques -->
                <div class="chart-container">
                    <h2 class="section-title"><i class="fas fa-chart-line"></i> Activité des votes (7 derniers jours)</h2>
                    <canvas id="votesChart"></canvas>
                </div>
                
                <!-- Recent Activity -->
                <div class="activity-section">
                    <h2 class="section-title"><i class="fas fa-history"></i> Activité Récentes</h2>
                    <div id="activityList"></div>
                </div>
                
                <!-- Quick Actions -->
                <div class="quick-actions-section">
                    <h2 class="section-title"><i class="fas fa-bolt"></i> Actions Rapides</h2>
                    <div class="quick-actions">
                        <div class="action-card" id="addElection">
                            <i class="fas fa-plus-circle"></i>
                            <h3>Ajouter Élection</h3>
                            <p>Créer une nouvelle élection</p>
                        </div>
                        <div class="action-card" id="addCandidate">
                            <i class="fas fa-user-plus"></i>
                            <h3>Ajouter Candidat</h3>
                            <p>Ajouter un nouveau candidat</p>
                        </div>
                        <div class="action-card" id="importMatricules">
                            <i class="fas fa-file-import"></i>
                            <h3>Importer Matricules</h3>
                            <p>Importer des matricules depuis un fichier</p>
                        </div>
                        <div class="action-card" id="viewReports">
                            <i class="fas fa-chart-bar"></i>
                            <h3>Voir Rapports</h3>
                            <p>Générer des rapports détaillés</p>
                        </div>
                    </div>
                </div>
                
                <!-- Code Generation -->
                <div class="generation-section" id="generation-section">
                    <h2 class="section-title"><i class="fas fa-key"></i> Générer des codes</h2>
                    <div class="input-group">
                        <input id="codeCountInput" max="100" min="1" placeholder="Nombre de codes (1-100)" type="number" />
                        <button class="btn-primary pulse-on-hover" id="generateBtn">
                            <i class="fas fa-bolt"></i> Générer
                        </button>
                    </div>
                </div>
                <div class="generated-codes-section" id="resultsSection" style="display:none;">
                    <h3 class="codes-title">Codes générés <span class="codes-count" id="codesCount"></span></h3>
                    <div class="codes-actions">
                        <button class="action-btn copy-btn" id="copyAllBtn">
                            <i class="fas fa-copy"></i> Copier tous
                        </button>
                        <button class="action-btn download-btn" id="downloadBtn">
                            <i class="fas fa-download"></i> Télécharger
                        </button>
                    </div>
                    <div class="codes-grid" id="codesContainer"></div>
                </div>
            `,

            users: `
                <div class="admin-header">
                    <h1><i class="fas fa-user-graduate"></i> Gestion des Étudiants</h1>
                    <div class="search-box">
                        <input type="text" placeholder="Rechercher par nom, matricule..." id="studentSearch">
                        <button><i class="fas fa-search"></i></button>
                    </div>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label for="filiereFilter">Filière</label>
                        <select id="filiereFilter">
                            <option value="all">Toutes les filières</option>
                            <option value="Informatique">Informatique</option>
                            <option value="Gestion">Gestion</option>
                            <option value="Droit">Droit</option>
                            <option value="Medecine">Médecine</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="anneeFilter">Année</label>
                        <select id="anneeFilter">
                            <option value="all">Toutes les années</option>
                            <option value="1">1ère année</option>
                            <option value="2">2ème année</option>
                            <option value="3">3ème année</option>
                            <option value="4">4ème année</option>
                            <option value="5">5ème année</option>
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="statusFilter">Statut</label>
                        <select id="statusFilter">
                            <option value="all">Tous</option>
                            <option value="active">Actifs</option>
                            <option value="inactive">Inactifs</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div>Photo</div>
                        <div>Nom Complet</div>
                        <div>Identifiant</div>
                        <div>Email</div>
                        <div>Filière/Année</div>
                        <div>Statut</div>
                        <div>Actions</div>
                    </div>
                    <div id="studentsList">
                        <!-- Les étudiants seront chargés ici dynamiquement -->
                    </div>
                </div>

                <div class="pagination" id="pagination">
                    <!-- Pagination sera chargée ici dynamiquement -->
                </div>
            `,

            elections: `
                <div class="admin-header">
                    <h2>Liste des élections</h2>
                    <button class="btn btn-primary" id="createElectionBtn">
                        <i class="fas fa-plus"></i> Nouvelle Élection
                    </button>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div>Nom de l'élection</div>
                        <div>Type</div>
                        <div>Date de début</div>
                        <div>Date de fin</div>
                        <div>Niveau</div>
                        <div>Actions</div>
                    </div>
                    <div id="electionsList">
                        <!-- Les élections seront chargées ici dynamiquement -->
                    </div>
                </div>

                <!-- Modal de création d'élection -->
                <div class="modal-overlay" id="electionModal">
                    <div class="modal">
                        <div class="modal-header">
                            <h2><i class="fas fa-vote-yea"></i> Nouvelle Élection</h2>
                            <button class="close-btn" id="closeModal">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="electionForm">
                                <div class="form-group">
                                    <label for="electionType">Type d'élection *</label>
                                    <select id="electionType" required>
                                        <option value="">Sélectionnez un type</option>
                                        <option value="SALLE">Élection de salle</option>
                                        <option value="ECOLE">Élection d'école</option>
                                        <option value="UNIVERSITE">Élection universitaire</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="electionNiveau">Niveau *</label>
                                    <select id="electionNiveau" required>
                                        <option value="">Sélectionnez un niveau</option>
                                        <option value="1">Niveau 1 - Responsables de Salle</option>
                                        <option value="2">Niveau 2 - Délégués d'École</option>
                                        <option value="3">Niveau 3 - Délégués Universitaires</option>
                                    </select>
                                </div>

                                <div class="form-group" id="delegueTypeGroup" style="display: none;">
                                    <label for="delegueType">Type de délégué</label>
                                    <select id="delegueType">
                                        <option value="">Sélectionnez un type</option>
                                        <option value="PREMIER">Premier Délégué</option>
                                        <option value="DEUXIEME">Deuxième Délégué</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="electionTitre">Titre de l'élection *</label>
                                    <input type="text" id="electionTitre" placeholder="Ex: Élection Responsables de Salle - Informatique L2" required>
                                </div>

                                <div class="form-group">
                                    <label for="electionDescription">Description</label>
                                    <textarea id="electionDescription" placeholder="Description de l'élection..."></textarea>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="startDate">Date de début *</label>
                                        <input type="datetime-local" id="startDate" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="endDate">Date de fin *</label>
                                        <input type="datetime-local" id="endDate" required>
                                    </div>
                                </div>

                                <!-- Champs conditionnels selon le type d'élection -->
                                <div id="conditionalFields" class="conditional-fields" style="display: none;">
                                    <div id="salleFields" style="display: none;">
                                        <div class="form-row">
                                            <div class="form-group">
                                                <label for="filiere">Filière *</label>
                                                <input type="text" id="filiere" placeholder="Ex: Informatique">
                                            </div>
                                            <div class="form-group">
                                                <label for="annee">Année *</label>
                                                <select id="annee">
                                                    <option value="">Sélectionnez une année</option>
                                                    <option value="1">Licence 1</option>
                                                    <option value="2">Licence 2</option>
                                                    <option value="3">Licence 3</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div id="ecoleFields" style="display: none;">
                                        <div class="form-group">
                                            <label for="ecole">École *</label>
                                            <select id="ecole">
                                                <option value="">Sélectionnez une école</option>
                                                <option value="EGEI">EGEI</option>
                                                <option value="ESMEA">ESMEA</option>
                                                <option value="FSAE">FSAE</option>
                                                <option value="FDE">FDE</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" id="cancelElection">Annuler</button>
                            <button class="btn btn-primary" id="saveElection">Enregistrer</button>
                        </div>
                    </div>
                </div>
            `,

            statistics: `
                <div class="admin-header">
                    <h1><i class="fas fa-chart-pie"></i> Statistiques</h1>
                    <div class="filter-group">
                        <label for="statsPeriod">Période</label>
                        <select id="statsPeriod">
                            <option value="7">7 derniers jours</option>
                            <option value="30">30 derniers jours</option>
                            <option value="90">3 derniers mois</option>
                            <option value="365">1 an</option>
                        </select>
                    </div>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label for="electionFilter">Élection</label>
                        <select id="electionFilter">
                            <option value="all">Toutes les élections</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>
                </div>

                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value" id="totalUsers">0</div>
                        <div class="stat-label">Utilisateurs inscrits</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-vote-yea"></i>
                        </div>
                        <div class="stat-value" id="totalVotes">0</div>
                        <div class="stat-label">Votes effectués</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-value" id="participationRate">0%</div>
                        <div class="stat-label">Taux de participation</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="avgVoteTime">0s</div>
                        <div class="stat-label">Temps moyen de vote</div>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-card">
                        <h3 class="chart-title"><i class="fas fa-chart-line"></i> Évolution des votes</h3>
                        <div class="chart-container">
                            <canvas id="votesChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <h3 class="chart-title"><i class="fas fa-chart-pie"></i> Répartition des votes</h3>
                        <div class="chart-container">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <h3 class="chart-title"><i class="fas fa-chart-bar"></i> Participation par heure</h3>
                        <div class="chart-container">
                            <canvas id="hourlyChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <h3 class="chart-title"><i class="fas fa-chart-area"></i> Comparaison par élection</h3>
                        <div class="chart-container">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="export-actions">
                    <button class="btn btn-primary" id="exportPDF">
                        <i class="fas fa-file-pdf"></i> Exporter en PDF
                    </button>
                    <button class="btn btn-primary" id="exportExcel">
                        <i class="fas fa-file-excel"></i> Exporter en Excel
                    </button>
                </div>
            `,

            candidates: `
                <div class="admin-header">
                    <h1><i class="fas fa-user-tie"></i> Gestion des Candidats</h1>
                    <button class="btn btn-primary" id="addCandidateBtn">
                        <i class="fas fa-plus"></i> Ajouter un Candidat
                    </button>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label for="candidateElectionFilter">Élection</label>
                        <select id="candidateElectionFilter">
                            <option value="all">Toutes les élections</option>
                            <!-- Options will be populated dynamically -->
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="candidateStatusFilter">Statut</label>
                        <select id="candidateStatusFilter">
                            <option value="all">Tous</option>
                            <option value="active">Actifs</option>
                            <option value="inactive">Inactifs</option>
                        </select>
                    </div>

                    <div class="search-box">
                        <input type="text" placeholder="Rechercher un candidat..." id="candidateSearch">
                        <button><i class="fas fa-search"></i></button>
                    </div>
                </div>

                <div class="table-container">
                    <div class="table-header">
                        <div>Photo</div>
                        <div>Candidat</div>
                        <div>Élection</div>
                        <div>Programme</div>
                        <div>Voix</div>
                        <div>Statut</div>
                        <div>Actions</div>
                    </div>
                    <div id="candidatesList">
                        <!-- Les candidats seront chargés ici dynamiquement -->
                    </div>
                </div>

                <div class="pagination" id="candidatePagination">
                    <!-- Pagination sera chargée ici dynamiquement -->
                </div>

                <!-- Modal d'ajout de candidat -->
                <div class="modal-overlay" id="candidateModal">
                    <div class="modal">
                        <div class="modal-header">
                            <h2><i class="fas fa-user-plus"></i> Nouveau Candidat</h2>
                            <button class="close-btn" id="closeCandidateModal">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="candidateForm">
                                <div class="form-group">
                                    <label for="candidateElection">Élection *</label>
                                    <select id="candidateElection" required>
                                        <option value="">Sélectionnez une élection</option>
                                        <!-- Options will be populated dynamically -->
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="candidateStudent">Étudiant *</label>
                                    <select id="candidateStudent" required>
                                        <option value="">Sélectionnez un étudiant</option>
                                        <!-- Options will be populated dynamically -->
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="candidateProgram">Programme électoral</label>
                                    <textarea id="candidateProgram" placeholder="Décrivez le programme du candidat..." rows="4"></textarea>
                                </div>

                                <div class="form-group">
                                    <label for="candidatePhoto">Photo du candidat</label>
                                    <input type="file" id="candidatePhoto" accept="image/*">
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" id="cancelCandidate">Annuler</button>
                            <button class="btn btn-primary" id="saveCandidate">Enregistrer</button>
                        </div>
                    </div>
                </div>
            `
        };

        // Fonction pour charger une page
        async function loadPage(pageName) {
            try {
                showLoading();

                // Mettre à jour la navigation
                document.querySelectorAll('.sidebar-menu li').forEach(li => {
                    li.classList.remove('active');
                });
                const activeItem = document.querySelector(`.sidebar-menu li a[data-page="${pageName}"]`);
                if (activeItem) {
                    activeItem.parentElement.classList.add('active');
                }

                // Mettre à jour le titre et le breadcrumb
                updatePageTitle(pageName);

                // Charger le contenu
                if (pageTemplates[pageName]) {
                    dynamicContent.innerHTML = pageTemplates[pageName];
                    initializePageScripts(pageName);
                } else {
                    throw new Error('Page non trouvée');
                }

                // Cacher le sidebar sur mobile après la sélection
                if (window.innerWidth <= 992) {
                    document.getElementById('sidebar').classList.remove('active');
                }
            } catch (error) {
                console.error('Erreur chargement page:', error);
                showToast('Erreur de chargement de la page', 'error');
                // Recharger la page dashboard par défaut
                loadPage('dashboard');
            } finally {
                hideLoading();
            }
        }

        function updatePageTitle(pageName) {
            const titles = {
                dashboard: 'Tableau de Bord',
                users: 'Gestion des Étudiants',
                elections: 'Gestion des Élections',
                candidates: 'Gestion des Candidats',
                statistics: 'Statistiques'
            };

            if (pageTitle) {
                const iconClass = {
                    dashboard: 'fa-tachometer-alt',
                    users: 'fa-user-graduate',
                    elections: 'fa-vote-yea',
                    candidates: 'fa-user-tie',
                    statistics: 'fa-chart-pie'
                }[pageName];

                pageTitle.innerHTML = `<i class="fas ${iconClass}"></i> ${titles[pageName]}`;
            }

            if (breadcrumb) {
                breadcrumb.innerHTML = `<span>Admin</span> / <span>${titles[pageName]}</span>`;
            }
        }

        function initializePageScripts(pageName) {
            // Initialiser les scripts spécifiques à chaque page
            switch (pageName) {
                case 'dashboard':
                    initDashboard();
                    break;
                case 'users':
                    initUsers();
                    break;
                case 'elections':
                    initElections();
                    break;
                case 'candidates':
                    initCandidates();
                    break;
                case 'statistics':
                    initStatistics();
                    break;
            }
        }

        // Fonctions d'initialisation pour chaque page
        function initDashboard() {
            loadStats();
            loadActivity();
            loadVoteStats();
            loadAdminInfo();
            loadNotifications();

            // Gestionnaire pour le bouton de génération de codes
            safeAddListener('generateBtn', 'click', generateCodes);
            safeAddListener('copyAllBtn', 'click', copyAllCodes);
            safeAddListener('downloadBtn', 'click', downloadCodes);

            // Gestionnaire pour les actions rapides
            safeAddListener('addElection', 'click', () => loadPage('elections'));
            safeAddListener('addCandidate', 'click', () => loadPage('candidates'));
            safeAddListener('importMatricules', 'click', () => {
                const modal = document.getElementById('importModal');
                if (modal) modal.classList.add('active');
            });
            safeAddListener('viewReports', 'click', () => loadPage('statistics'));
        }

        function initUsers() {
            loadStudents(1);

            // Gestionnaires d'événements pour les filtres
            safeAddListener('filiereFilter', 'change', () => loadStudents(1));
            safeAddListener('anneeFilter', 'change', () => loadStudents(1));
            safeAddListener('statusFilter', 'change', () => loadStudents(1));
            safeAddListener('studentSearch', 'input', debounce(() => loadStudents(1), 300));
            document.querySelector('.search-box button').addEventListener('click', () => loadStudents(1));
        }

        function initElections() {
            loadElections();

            // Gestion des champs conditionnels
            const electionType = document.getElementById('electionType');
            const electionNiveau = document.getElementById('electionNiveau');
            const delegueTypeGroup = document.getElementById('delegueTypeGroup');
            const conditionalFields = document.getElementById('conditionalFields');
            const salleFields = document.getElementById('salleFields');
            const ecoleFields = document.getElementById('ecoleFields');

            if (electionType && electionNiveau) {
                electionType.addEventListener('change', updateElectionFormFields);
                electionNiveau.addEventListener('change', updateElectionFormFields);
            }

            function updateElectionFormFields() {
                const type = electionType.value;
                const niveau = electionNiveau.value;

                // Afficher/masquer le type de délégué
                if (delegueTypeGroup) {
                    if (niveau === '2') {
                        delegueTypeGroup.style.display = 'block';
                    } else {
                        delegueTypeGroup.style.display = 'none';
                    }
                }

                // Gérer les champs conditionnels
                if (conditionalFields) {
                    conditionalFields.style.display = 'block';
                    if (salleFields) salleFields.style.display = 'none';
                    if (ecoleFields) ecoleFields.style.display = 'none';

                    if (type === 'SALLE') {
                        if (salleFields) salleFields.style.display = 'block';
                    } else if (type === 'ECOLE') {
                        if (ecoleFields) ecoleFields.style.display = 'block';
                    } else if (type === 'UNIVERSITE') {
                        conditionalFields.style.display = 'none';
                    } else {
                        conditionalFields.style.display = 'none';
                    }
                }
            }

            // Gestionnaires pour la modal d'élection
            safeAddListener('createElectionBtn', 'click', () => {
                const modal = document.getElementById('electionModal');
                if (modal) modal.classList.add('active');
            });

            safeAddListener('closeModal', 'click', () => {
                const modal = document.getElementById('electionModal');
                if (modal) modal.classList.remove('active');
            });

            safeAddListener('cancelElection', 'click', () => {
                const modal = document.getElementById('electionModal');
                if (modal) modal.classList.remove('active');
            });

            safeAddListener('saveElection', 'click', createElection);
        }

        function initCandidates() {
            loadCandidates(1);

            // Gestionnaires d'événements pour les filtres
            safeAddListener('candidateElectionFilter', 'change', () => loadCandidates(1));
            safeAddListener('candidateStatusFilter', 'change', () => loadCandidates(1));
            safeAddListener('candidateSearch', 'input', debounce(() => loadCandidates(1), 300));
            document.querySelector('.search-box button').addEventListener('click', () => loadCandidates(1));

            // Gestionnaire pour le bouton d'ajout de candidat
            safeAddListener('addCandidateBtn', 'click', () => {
                const modal = document.getElementById('candidateModal');
                if (modal) modal.classList.add('active');
            });
        }

        function initStatistics() {
            loadElectionsForFilter();
            loadGeneralStats();
            loadChartsData();

            // Gestionnaires d'événements pour les filtres
            safeAddListener('statsPeriod', 'change', () => {
                loadGeneralStats();
                loadChartsData();
            });

            safeAddListener('electionFilter', 'change', () => {
                loadGeneralStats();
                loadChartsData();
            });

            // Gestionnaires pour les boutons d'export
            safeAddListener('exportPDF', 'click', () => exportData('pdf'));
            safeAddListener('exportExcel', 'click', () => exportData('xlsx'));
        }

        // ------------ NOTIFICATIONS ------------
        safeAddListener('notificationBtn', 'click', function (e) {
            e.preventDefault();
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('active');

            // Charger les notifications si le panel est ouvert
            if (panel.classList.contains('active')) {
                loadNotifications();
            }
        });

        async function loadNotifications() {
            try {
                const response = await fetch(`${API_BASE}${NOTIFICATIONS_ENDPOINT}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) throw new Error('Erreur de chargement des notifications');

                const notifications = await response.json();
                displayNotifications(notifications);

                // Mettre à jour le badge
                const unreadCount = notifications.filter(n => !n.read).length;
                const badge = document.getElementById('notificationCount');
                if (badge) {
                    badge.textContent = unreadCount;
                    badge.style.display = unreadCount > 0 ? 'block' : 'none';
                }
            } catch (error) {
                console.error('Erreur:', error);
                showToast('Erreur de chargement des notifications', 'error');
            }
        }

        function displayNotifications(notifications) {
            const container = document.getElementById('notificationList');
            if (!container) return;

            container.innerHTML = '';

            if (notifications.length === 0) {
                container.innerHTML = '<p style="padding: 20px; text-align: center; color: var(--gris-moyen);">Aucune notification</p>';
                return;
            }

            notifications.forEach(notification => {
                const div = document.createElement('div');
                div.className = `notification-item ${notification.read ? '' : 'unread'}`;
                div.innerHTML = `
                    <div class="notification-content">${notification.message}</div>
                    <div class="notification-time">${new Date(notification.createdAt).toLocaleString()}</div>
                `;

                div.addEventListener('click', async () => {
                    if (!notification.read) {
                        await markAsRead(notification.id);
                        div.classList.remove('unread');
                        loadNotifications(); // Recharger pour mettre à jour le badge
                    }
                });

                container.appendChild(div);
            });
        }

        async function markAsRead(notificationId) {
            try {
                await fetch(`${API_BASE}${NOTIFICATIONS_READ_ENDPOINT.replace(':id', notificationId)}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
            } catch (error) {
                console.error('Erreur:', error);
            }
        }

        safeAddListener('markAllReadBtn', 'click', async function () {
            try {
                await fetch(`${API_BASE}${NOTIFICATIONS_READ_ENDPOINT.replace(':id', 'all')}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                loadNotifications(); // Recharger les notifications
                showToast('Toutes les notifications marquées comme lues', 'success');
            } catch (error) {
                console.error('Erreur:', error);
                showToast('Erreur lors du marquage des notifications', 'error');
            }
        });

        // Fermer le panel de notifications en cliquant à l'extérieur
        document.addEventListener('click', function (e) {
            const panel = document.getElementById('notificationPanel');
            const btn = document.getElementById('notificationBtn');

            if (panel && panel.classList.contains('active') &&
                !panel.contains(e.target) &&
                !btn.contains(e.target)) {
                panel.classList.remove('active');
            }
        });

        // ------------ ADMIN INFO ------------
        async function loadAdminInfo() {
            try {
                showLoading();
                const res = await fetch(`${API_BASE}${ADMIN_ME_ENDPOINT}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!res.ok) throw new Error('Erreur chargement profil');

                const admin = await res.json();
                updateAdminUI(admin);
            } catch (err) {
                console.error('Erreur chargement info admin:', err);
                showToast('Erreur de chargement du profil', 'error');
            } finally {
                hideLoading();
            }
        }

        function updateAdminUI(admin) {
            const elements = {
                headerUserName: `${admin.nom || ''} ${admin.prenom || ''}`,
                headerUserRole: admin.poste || 'Administrateur'
            };

            Object.entries(elements).forEach(([id, value]) => {
                const el = document.getElementById(id);
                if (el) {
                    el.textContent = value;
                }
            });

            if (admin.photoUrl) {
                const userAvatar = document.querySelector('.user-avatar');
                if (userAvatar) userAvatar.src = admin.photoUrl + '?t=' + Date.now();
            }
        }

        // ------------ DASHBOARD DATA ------------
        async function loadStats() {
            try {
                const res = await fetch(`${API_BASE}${STATS_ENDPOINT}`, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();

                const totalUsers = document.getElementById('totalUsers');
                const totalVotes = document.getElementById('totalVotes');
                const totalCandidates = document.getElementById('totalCandidates');
                const activeElections = document.getElementById('activeElections');
                const usersProgress = document.getElementById('usersProgress');
                const votesProgress = document.getElementById('votesProgress');
                const candidatesProgress = document.getElementById('candidatesProgress');
                const electionsProgress = document.getElementById('electionsProgress');

                if (totalUsers) totalUsers.textContent = data.users?.total || 0;
                if (totalVotes) totalVotes.textContent = data.votes?.total || 0;
                if (totalCandidates) totalCandidates.textContent = data.candidates?.total || 0;
                if (activeElections) activeElections.textContent = data.elections?.active || 0;
                if (usersProgress) usersProgress.style.width = (data.users?.percent || 0) + '%';
                if (votesProgress) votesProgress.style.width = (data.votes?.percent || 0) + '%';
                if (candidatesProgress) candidatesProgress.style.width = (data.candidates?.percent || 0) + '%';
                if (electionsProgress) electionsProgress.style.width = (data.elections?.percent || 0) + '%';
            } catch (err) {
                console.error('Erreur chargement stats:', err);
            }
        }

        async function loadActivity() {
            try {
                const res = await fetch(`${API_BASE}${ACTIVITY_ENDPOINT}`, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const activities = await res.json();
                const container = document.getElementById('activityList');
                if (!container) return;

                container.innerHTML = '';
                activities.forEach(act => {
                    const div = document.createElement('div');
                    div.classList.add('activity-item');
                    div.innerHTML = `
                        <div class="activity-icon"><i class="fas fa-check"></i></div>
                        <div class="activity-content">
                            <h4>${act.title}</h4>
                            <p>${act.content}</p>
                        </div>
                        <div class="activity-time">${act.time}</div>
                    `;
                    container.appendChild(div);
                });
            } catch (err) {
                console.error('Erreur chargement activités:', err);
            }
        }

        async function loadVoteStats() {
            try {
                const res = await fetch(`${API_BASE}${VOTE_STATS_ENDPOINT}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const stats = await res.json();

                // Créer le graphique des votes
                const ctx = document.getElementById('votesChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: stats.dates || [],
                        datasets: [{
                            label: 'Votes par jour',
                            data: stats.values || [],
                            borderColor: '#7a0026',
                            backgroundColor: 'rgba(122, 0, 38, 0.1)',
                            tension: 0.3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            } catch (err) {
                console.error('Erreur chargement stats votes:', err);
            }
        }

        // ------------ CODE GENERATION ------------
        async function generateCodes() {
            const countInput = document.getElementById('codeCountInput');
            const count = parseInt(countInput?.value);

            if (!count || count < 1 || count > 100) {
                showToast('Veuillez entrer un nombre entre 1 et 100', 'error');
                return;
            }

            const generateBtn = document.getElementById('generateBtn');
            if (!generateBtn) return;

            const originalBtnText = generateBtn.innerHTML;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Génération...';
            generateBtn.disabled = true;

            try {
                showLoading();
                const response = await fetch(`${API_BASE}${CODES_GENERATE_ENDPOINT}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ quantity: count })
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.message || 'Erreur lors de la génération');

                displayGeneratedCodes(data.codes);
                showToast(`${data.codes.length} codes générés avec succès`, 'success');
            } catch (error) {
                console.error('Erreur génération codes:', error);
                showToast(error.message || 'Échec de la génération', 'error');
            } finally {
                generateBtn.innerHTML = originalBtnText;
                generateBtn.disabled = false;
                hideLoading();
            }
        }

        function displayGeneratedCodes(codes) {
            const container = document.getElementById('codesContainer');
            const resultsSection = document.getElementById('resultsSection');
            if (!container || !resultsSection) return;

            container.innerHTML = '';
            codes.forEach(code => {
                const codeElement = document.createElement('div');
                codeElement.className = 'code-item';
                codeElement.innerHTML = `
                    <span>${code}</span>
                    <button class="copy-single-btn" data-code="${code}">
                        <i class="fas fa-copy"></i>
                    </button>
                `;
                container.appendChild(codeElement);
            });

            document.querySelectorAll('.copy-single-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    const code = this.getAttribute('data-code');
                    navigator.clipboard.writeText(code)
                        .then(() => {
                            this.innerHTML = '<i class="fas fa-check" style="color:green;"></i>';
                            setTimeout(() => {
                                this.innerHTML = '<i class="fas fa-copy"></i>';
                            }, 2000);
                        });
                });
            });

            resultsSection.style.display = 'block';
            const codesCount = document.getElementById('codesCount');
            if (codesCount) codesCount.textContent = `(${codes.length} codes)`;
            resultsSection.style.animation = 'fadeIn 0.3s ease-out';
        }

        function copyAllCodes() {
            const codes = Array.from(document.querySelectorAll('.code-item span'))
                .map(el => el.textContent)
                .join('\n');

            navigator.clipboard.writeText(codes)
                .then(() => {
                    const copyBtn = document.getElementById('copyAllBtn');
                    if (!copyBtn) return;

                    const originalHtml = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> Copié !';
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHtml;
                    }, 2000);
                })
                .catch(err => {
                    console.error('Erreur copie:', err);
                    showToast('Erreur lors de la copie', 'error');
                });
        }

        function downloadCodes() {
            const codes = Array.from(document.querySelectorAll('.code-item span'))
                .map(el => el.textContent)
                .join('\n');

            const blob = new Blob([codes], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `codes-ucao-${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // ------------ USERS MANAGEMENT ------------
        let currentPage = 1;
        const studentsPerPage = 10;
        let totalStudents = 0;
        let totalPages = 0;

        async function loadStudents(page = 1) {
            try {
                showLoading();
                currentPage = page;

                const filiereFilter = document.getElementById('filiereFilter').value;
                const anneeFilter = document.getElementById('anneeFilter').value;
                const statusFilter = document.getElementById('statusFilter').value;
                const searchTerm = document.getElementById('studentSearch').value;

                let url = `${API_BASE}${STUDENTS_ENDPOINT}?page=${page}&limit=${studentsPerPage}`;
                const params = new URLSearchParams();

                if (filiereFilter !== 'all') params.append('filiere', filiereFilter);
                if (anneeFilter !== 'all') params.append('annee', anneeFilter);
                if (statusFilter !== 'all') params.append('status', statusFilter);
                if (searchTerm) params.append('search', searchTerm);

                if (params.toString()) url += `&${params.toString()}`;

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('Erreur lors du chargement des étudiants');

                const data = await response.json();
                totalStudents = data.total;
                totalPages = Math.ceil(totalStudents / studentsPerPage);

                displayStudents(data.students);
                setupPagination();
            } catch (error) {
                console.error('Erreur:', error);
                showToast('Erreur de chargement des étudiants', 'error');
            } finally {
                hideLoading();
            }
        }

        function displayStudents(students) {
            const container = document.getElementById('studentsList');
            if (!container) return;

            container.innerHTML = '';

            if (students.length === 0) {
                container.innerHTML = `
                    <div class="table-row">
                        <div colspan="7" style="text-align: center; padding: 30px;">
                            <i class="fas fa-user-graduate" style="font-size: 2rem; color: var(--gris-moyen); margin-bottom: 10px;"></i>
                            <p>Aucun étudiant trouvé</p>
                        </div>
                    </div>
                `;
                return;
            }

            students.forEach(student => {
                const row = document.createElement('div');
                row.className = 'table-row';

                // Déterminer l'identifiant (matricule ou code)
                const identifiant = student.matricule || student.codeInscription || 'N/A';

                // Photo de l'étudiant
                const photoUrl = student.photoUrl || 'https://img.freepik.com/photos-premium/photo-etudiant-i-image-etudiant-i-etudiants-souriants-i-etudiant-universitaire-i-etudiants-collage_403587-2980.jpg';

                row.innerHTML = `
                    <div data-label="Photo">
                        <img src="${photoUrl}" alt="${student.prenom} ${student.nom}" class="student-photo"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MCIgaGVpZ2h0PSI1MCIgdmlld0JveD0iMCAwIDUwIDUwIj48Y2lyY2xlIGN4PSIyNSIgY3k9IjI1IiByPSIyMCIgZmlsbD0iI2U1ZTVlNSIvPjx0ZXh0IHg9IjI1IiB5PSIyOCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBhbGlnbm1lbnQtYmFzZWxpbmU9Im1pZGRsZSIgZmlsbD0iIzk5OTk5OSI+RVQ8L3RleHQ+PC9zdmc+'">
                    </div>
                    <div data-label="Nom">${student.prenom} ${student.nom}</div>
                    <div data-label="Identifiant">${identifiant}</div>
                    <div data-label="Email">${student.user?.email || 'N/A'}</div>
                    <div data-label="Filière/Année">${student.filiere || 'N/A'} / ${student.annee || 'N/A'}</div>
                    <div data-label="Statut">
                        <span class="status-badge ${student.user?.actif ? 'status-active' : 'status-inactive'}">
                            ${student.user?.actif ? 'Actif' : 'Inactif'}
                        </span>
                    </div>
                    <div data-label="Actions" class="action-buttons">
                        <div class="btn-icon btn-edit toggle-status" data-id="${student.userId}" data-status="${student.user?.actif}">
                            <i class="fas ${student.user?.actif ? 'fa-user-slash' : 'fa-user-check'}"></i>
                        </div>
                    </div>
                `;

                container.appendChild(row);
            });

            // Ajouter les écouteurs d'événements
            document.querySelectorAll('.toggle-status').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const userId = e.currentTarget.getAttribute('data-id');
                    const currentStatus = e.currentTarget.getAttribute('data-status') === 'true';
                    toggleStudentStatus(userId, !currentStatus);
                });
            });
        }

        // Configurer la pagination
        function setupPagination() {
            const paginationContainer = document.getElementById('pagination');
            if (!paginationContainer) return;

            paginationContainer.innerHTML = '';

            if (totalPages <= 1) return;

            // Bouton précédent
            if (currentPage > 1) {
                const prevBtn = document.createElement('div');
                prevBtn.className = 'pagination-btn';
                prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
                prevBtn.addEventListener('click', () => loadStudents(currentPage - 1));
                paginationContainer.appendChild(prevBtn);
            }

            // Pages
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('div');
                pageBtn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => loadStudents(i));
                paginationContainer.appendChild(pageBtn);
            }

            // Bouton suivant
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('div');
                nextBtn.className = 'pagination-btn';
                nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                nextBtn.addEventListener('click', () => loadStudents(currentPage + 1));
                paginationContainer.appendChild(nextBtn);
            }
        }

        // Changer le statut d'un étudiant
        async function toggleStudentStatus(userId, newStatus) {
            try {
                showLoading();
                const response = await fetch(`${API_BASE}${STUDENT_UPDATE_ENDPOINT.replace(':id', userId)}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ actif: newStatus })
                });

                if (!response.ok) throw new Error('Erreur lors de la modification du statut');

                showToast(`Étudiant ${newStatus ? 'activé' : 'désactivé'} avec succès`);
                loadStudents(currentPage);
            } catch (error) {
                console.error('Erreur:', error);
                showToast(error.message || 'Erreur lors de la modification', 'error');
            } finally {
                hideLoading();
            }
        }

        // ------------ ELECTIONS MANAGEMENT ------------
        async function loadElections() {
            try {
                showLoading();
                const response = await fetch(`${API_BASE}${ELECTIONS_ENDPOINT}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('Erreur lors du chargement des élections');

                const data = await response.json();
                displayElections(data.elections || data);
            } catch (error) {
                console.error('Erreur:', error);
                showToast('Erreur de chargement des élections', 'error');
            } finally {
                hideLoading();
            }
        }

        function displayElections(elections) {
            const container = document.getElementById('electionsList');
            if (!container) return;

            container.innerHTML = '';

            if (!elections || elections.length === 0) {
                container.innerHTML = `
                    <div class="table-row">
                        <div colspan="6" style="text-align: center; padding: 30px;">
                            Aucune élection trouvée. Cliquez sur "Nouvelle Élection" pour en créer une.
                        </div>
                    </div>
                `;
                return;
            }

            elections.forEach(election => {
                const row = document.createElement('div');
                row.className = 'table-row';

                // Déterminer le statut
                const now = new Date();
                const startDate = new Date(election.dateDebut);
                const endDate = new Date(election.dateFin);

                let statusClass = 'status-upcoming';
                let statusText = 'À venir';

                if (now >= startDate && now <= endDate) {
                    statusClass = 'status-active';
                    statusText = 'Active';
                } else if (now > endDate) {
                    statusClass = 'status-completed';
                    statusText = 'Terminée';
                }

                // Formater le type d'élection
                let typeText = election.type;
                if (election.type === 'SALLE') typeText = 'Salle';
                if (election.type === 'ECOLE') typeText = 'École';
                if (election.type === 'UNIVERSITE') typeText = 'Université';

                row.innerHTML = `
                    <div>${election.titre}</div>
                    <div><span class="election-type">${typeText}</span></div>
                    <div>${formatDate(election.dateDebut)}</div>
                    <div>${formatDate(election.dateFin)}</div>
                    <div>N${election.niveau}</div>
                    <div class="action-buttons">
                        <div class="btn-icon btn-edit" data-id="${election.id}">
                            <i class="fas fa-edit"></i>
                        </div>
                        <div class="btn-icon btn-delete" data-id="${election.id}">
                            <i class="fas fa-trash"></i>
                        </div>
                    </div>
                `;

                container.appendChild(row);
            });

            // Ajouter les écouteurs d'événements pour les boutons
            document.querySelectorAll('.btn-edit').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const electionId = e.currentTarget.getAttribute('data-id');
                    editElection(electionId);
                });
            });

            document.querySelectorAll('.btn-delete').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const electionId = e.currentTarget.getAttribute('data-id');
                    deleteElection(electionId);
                });
            });
        }

        async function createElection() {
            const electionData = {
                type: document.getElementById('electionType').value,
                niveau: parseInt(document.getElementById('electionNiveau').value),
                titre: document.getElementById('electionTitre').value,
                description: document.getElementById('electionDescription').value,
                dateDebut: document.getElementById('startDate').value,
                dateFin: document.getElementById('endDate').value
            };

            // Ajouter le type de délégué si niveau 2
            if (electionData.niveau === 2) {
                electionData.delegueType = document.getElementById('delegueType').value;
            }

            // Ajouter les champs conditionnels
            if (electionData.type === 'SALLE') {
                electionData.filiere = document.getElementById('filiere').value;
                electionData.annee = parseInt(document.getElementById('annee').value);
            } else if (electionData.type === 'ECOLE') {
                electionData.ecole = document.getElementById('ecole').value;
            }

            // Validation des données
            if (!electionData.type) {
                showToast('Veuillez sélectionner un type d\'élection', 'error');
                return;
            }

            if (!electionData.niveau) {
                showToast('Veuillez sélectionner un niveau', 'error');
                return;
            }

            if (!electionData.titre) {
                showToast('Veuillez saisir un titre pour l\'élection', 'error');
                return;
            }

            if (electionData.type === 'SALLE' && (!electionData.filiere || !electionData.annee)) {
                showToast('Veuillez remplir tous les champs obligatoires pour une élection de salle', 'error');
                return;
            }

            if (electionData.type === 'ECOLE' && !electionData.ecole) {
                showToast('Veuillez saisir le nom de l\'école', 'error');
                return;
            }

            if (electionData.niveau === 2 && !electionData.delegueType) {
                showToast('Veuillez sélectionner un type de délégué', 'error');
                return;
            }

            // Validation des dates
            if (new Date(electionData.dateDebut) >= new Date(electionData.dateFin)) {
                showToast('La date de fin doit être postérieure à la date de début', 'error');
                return;
            }

            try {
                showLoading();
                const response = await fetch(`${API_BASE}${ELECTION_CREATE_ENDPOINT}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(electionData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Erreur lors de la création');
                }

                const result = await response.json();
                showToast('Élection créée avec succès');

                // Fermer la modal et recharger la liste
                const modal = document.getElementById('electionModal');
                if (modal) modal.classList.remove('active');

                loadElections();
            } catch (error) {
                console.error('Erreur:', error);
                showToast(error.message || 'Erreur lors de la création', 'error');
            } finally {
                hideLoading();
            }
        }

        async function deleteElection(electionId) {
            if (!confirm('Êtes-vous sûr de vouloir supprimer cette élection ?')) return;

            try {
                showLoading();
                const response = await fetch(`${API_BASE}${ELECTION_DELETE_ENDPOINT}/${electionId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('Erreur lors de la suppression');

                showToast('Élection supprimée avec succès');
                loadElections();
            } catch (error) {
                console.error('Erreur:', error);
                showToast('Erreur lors de la suppression', 'error');
            } finally {
                hideLoading();
            }
        }

        // ------------ STATISTICS ------------
        async function loadElectionsForFilter() {
            try {
                const response = await fetch(`${API_BASE}${ELECTIONS_ENDPOINT}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('Erreur lors du chargement des élections');

                const elections = await response.json();
                populateElectionFilter(elections);
            } catch (error) {
                console.error('Erreur:', error);
                showToast('Erreur de chargement des élections', 'error');
            }
        }

        function populateElectionFilter(elections) {
            const electionFilter = document.getElementById('electionFilter');
            if (!electionFilter) return;

            electionFilter.innerHTML = '<option value="all">Toutes les élections</option>';

            elections.forEach(election => {
                const option = document.createElement('option');
                option.value = election.id;
                option.textContent = election.titre || election.name;
                electionFilter.appendChild(option);
            });
        }

        async function loadGeneralStats() {
            try {
                showLoading();
                const electionId = document.getElementById('electionFilter').value;
                const period = document.getElementById('statsPeriod').value;

                let url = `${API_BASE}${STATS_GENERAL_ENDPOINT}?period=${period}`;
                if (electionId !== 'all') url += `&electionId=${electionId}`;

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('Erreur lors du chargement des statistiques');

                const stats = await response.json();
                updateGeneralStats(stats);
            } catch (error) {
                console.error('Erreur:', error);
                showToast('Erreur de chargement des statistiques', 'error');
            } finally {
                hideLoading();
            }
        }

        function updateGeneralStats(stats) {
            const totalUsers = document.getElementById('totalUsers');
            const totalVotes = document.getElementById('totalVotes');
            const participationRate = document.getElementById('participationRate');
            const avgVoteTime = document.getElementById('avgVoteTime');

            if (totalUsers) totalUsers.textContent = stats.totalUsers?.toLocaleString() || '0';
            if (totalVotes) totalVotes.textContent = stats.totalVotes?.toLocaleString() || '0';
            if (participationRate) participationRate.textContent = `${stats.participationRate || '0'}%`;
            if (avgVoteTime) avgVoteTime.textContent = `${stats.avgVoteTime || '0'}s`;
        }

        async function loadChartsData() {
            try {
                const electionId = document.getElementById('electionFilter').value;
                const period = document.getElementById('statsPeriod').value;

                // Charger les données pour chaque graphique
                const [votesData, distributionData, hourlyData, comparisonData] = await Promise.all([
                    fetchChartData(STATS_VOTES_ENDPOINT, electionId, period),
                    electionId !== 'all' ? fetchChartData(STATS_DISTRIBUTION_ENDPOINT, electionId, period) : Promise.resolve({ labels: [], values: [] }),
                    fetchChartData(STATS_HOURLY_ENDPOINT, electionId, period),
                    fetchChartData(STATS_COMPARISON_ENDPOINT, electionId, period)
                ]);

                // Mettre à jour les graphiques
                updateVotesChart(votesData);
                if (electionId !== 'all') {
                    updateDistributionChart(distributionData);
                }
                updateHourlyChart(hourlyData);
                updateComparisonChart(comparisonData);
            } catch (error) {
                console.error('Erreur:', error);
                showToast('Erreur de chargement des graphiques', 'error');
            }
        }

        async function fetchChartData(endpoint, electionId, period) {
            let url = `${API_BASE}${endpoint}?period=${period}`;
            if (electionId !== 'all') url += `&electionId=${electionId}`;

            const response = await fetch(url, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (!response.ok) throw new Error(`Erreur lors du chargement des données pour ${endpoint}`);

            return await response.json();
        }

        // Mettre à jour les graphiques
        function updateVotesChart(data) {
            const ctx = document.getElementById('votesChart');
            if (!ctx) return;

            const chartCtx = ctx.getContext('2d');

            if (window.votesChartInstance) {
                window.votesChartInstance.destroy();
            }

            window.votesChartInstance = new Chart(chartCtx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Votes par jour',
                        data: data.values,
                        borderColor: '#7a0026',
                        backgroundColor: 'rgba(122, 0, 38, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }

        function updateDistributionChart(data) {
            const ctx = document.getElementById('distributionChart');
            if (!ctx) return;

            const chartCtx = ctx.getContext('2d');

            if (window.distributionChartInstance) {
                window.distributionChartInstance.destroy();
            }

            // Préparer les couleurs
            const backgroundColors = [
                '#7a0026', '#a73354', '#0f1a31', '#1e2b4d', '#c9a227',
                '#3a506b', '#5c6b73', '#8d99ae', '#d90429', '#ff9e00'
            ];

            window.distributionChartInstance = new Chart(chartCtx, {
                type: 'pie',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.values,
                        backgroundColor: backgroundColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
        }

        function updateHourlyChart(data) {
            const ctx = document.getElementById('hourlyChart');
            if (!ctx) return;

            const chartCtx = ctx.getContext('2d');

            if (window.hourlyChartInstance) {
                window.hourlyChartInstance.destroy();
            }

            window.hourlyChartInstance = new Chart(chartCtx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Nombre de votes',
                        data: data.values,
                        backgroundColor: 'rgba(122, 0, 38, 0.7)',
                        borderColor: '#7a0026',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }

        function updateComparisonChart(data) {
            const ctx = document.getElementById('comparisonChart');
            if (!ctx) return;

            const chartCtx = ctx.getContext('2d');

            if (window.comparisonChartInstance) {
                window.comparisonChartInstance.destroy();
            }

            window.comparisonChartInstance = new Chart(chartCtx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [
                        {
                            label: 'Inscrits',
                            data: data.registered,
                            backgroundColor: 'rgba(15, 26, 49, 0.7)',
                            borderColor: '#0f1a31',
                            borderWidth: 1
                        },
                        {
                            label: 'Votants',
                            data: data.voters,
                            backgroundColor: 'rgba(122, 0, 38, 0.7)',
                            borderColor: '#7a0026',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
        }

        async function exportData(format) {
            try {
                showLoading();
                const electionId = document.getElementById('electionFilter').value;
                const period = document.getElementById('statsPeriod').value;

                let url = `${API_BASE}${STATS_EXPORT_ENDPOINT}?format=${format}&period=${period}`;
                if (electionId !== 'all') url += `&electionId=${electionId}`;

                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) throw new Error('Erreur lors de l\'export');

                const blob = await response.blob();
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = `statistiques-ucao-${new Date().toISOString().slice(0, 10)}.${format}`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(downloadUrl);

                showToast(`Export ${format.toUpperCase()} réussi`);
            } catch (error) {
                console.error('Erreur:', error);
                showToast(`Erreur lors de l'export ${format.toUpperCase()}`, 'error');
            } finally {
                hideLoading();
            }
        }

        // ------------ CANDIDATES MANAGEMENT ------------
        async function loadCandidates(page = 1) {
            // Implémentation similaire à loadStudents
            // Cette fonction chargerait la liste des candidats
            console.log("Chargement des candidats, page", page);
            // Implémentation à compléter selon les endpoints API disponibles
        }

        // ------------ INITIAL LOAD ------------
        document.addEventListener('DOMContentLoaded', async function () {
            // Gestion du menu mobile
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');

            function updateMenu() {
                if (window.innerWidth <= 992) {
                    menuToggle.style.display = 'flex';
                    sidebar.classList.remove('active');
                } else {
                    menuToggle.style.display = 'none';
                    sidebar.classList.add('active');
                }
            }

            menuToggle.addEventListener('click', function () {
                sidebar.classList.toggle('active');
            });

            window.addEventListener('resize', updateMenu);
            updateMenu();

            // Gestion du menu utilisateur
            const userToggle = document.getElementById('userToggle');
            const userDropdown = document.getElementById('userDropdown');

            userToggle.addEventListener('click', function (e) {
                e.stopPropagation();
                userDropdown.classList.toggle('active');
            });

            // Fermer le dropdown en cliquant à l'extérieur
            document.addEventListener('click', function (e) {
                if (userDropdown.classList.contains('active') && !userToggle.contains(e.target) && !userDropdown.contains(e.target)) {
                    userDropdown.classList.remove('active');
                }
            });

            // Gestionnaire de déconnexion
            safeAddListener('logoutBtn', 'click', function (e) {
                e.preventDefault();
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminRole');
                window.location.href = 'index.html';
            });

            // Navigation sidebar
            document.querySelectorAll('.sidebar-menu a[data-page]').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    loadPage(page);

                    // Mettre à jour l'URL sans recharger la page
                    window.history.pushState({ page }, '', `?page=${page}`);
                });
            });

            // Gestion du bouton retour
            window.addEventListener('popstate', function (event) {
                if (event.state && event.state.page) {
                    loadPage(event.state.page);
                } else {
                    loadPage('dashboard');
                }
            });

            // Charger la page initiale
            const urlParams = new URLSearchParams(window.location.search);
            const pageParam = urlParams.get('page');
            loadPage(pageParam || 'dashboard');

            // Vérification du rôle admin
            if (token) {
                try {
                    const response = await fetch(`${API_BASE}${ADMIN_ME_ENDPOINT}`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    const user = await response.json();

                    if (user.role !== 'ADMIN') {
                        const genSection = document.getElementById('generation-section');
                        if (genSection) genSection.style.display = 'none';
                    }
                } catch (error) {
                    console.error('Erreur vérification rôle:', error);
                }
            }
        });
    </script>
</body>

</html>